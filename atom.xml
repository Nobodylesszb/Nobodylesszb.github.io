<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://Nobodylesszb.github.io</id>
    <title>åš</title>
    <updated>2020-07-11T03:51:36.105Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://Nobodylesszb.github.io"/>
    <link rel="self" href="https://Nobodylesszb.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://Nobodylesszb.github.io/images/avatar.png</logo>
    <icon>https://Nobodylesszb.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, åš</rights>
    <entry>
        <title type="html"><![CDATA[kong/kongaä¹‹dockeréƒ¨ç½²]]></title>
        <id>https://Nobodylesszb.github.io/post/Uhr6PBQSr/</id>
        <link href="https://Nobodylesszb.github.io/post/Uhr6PBQSr/">
        </link>
        <updated>2020-07-11T02:34:27.000Z</updated>
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€">1. å‰è¨€</h2>
<p>æœ€è¿‘é¡¹ç›®æœ‰ç”¨åˆ°kongæ¥åšç½‘å…³ï¼Œæ‰€ä»¥æ¥æœ¬æœºå®‰è£…ä»¥ä¸‹</p>
<h2 id="2-kongæ”¯æŒçš„ç¯å¢ƒ">2. Kongæ”¯æŒçš„ç¯å¢ƒ</h2>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594395050-webp-20200710233050613.jpg" alt="img" loading="lazy"></figure>
<p>image.png</p>
<p>ä»ä¸Šå›¾æ¥çœ‹Kongå¯¹Linuxã€MacOSã€å®¹å™¨ã€äº‘ æ”¯æŒçš„è¿˜æ˜¯æ¯”è¾ƒå…¨é¢çš„ã€‚</p>
<p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fkonghq.com%2F">å®˜ç½‘åœ°å€</a><br>
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FKong%2Fkong">githubåœ°å€</a></p>
<h2 id="3-å®‰è£…kong">3. å®‰è£…Kong</h2>
<p>ä½ çš„æœºå™¨ä¸­å¿…é¡»æœ‰Dockerç¯å¢ƒï¼Œè¿™ä¸ªæ˜¯å‰æã€‚ã€‚Kong å®‰è£…æœ‰ä¸¤ç§æ–¹å¼ä¸€ç§æ˜¯æ²¡æœ‰æ•°æ®åº“ä¾èµ–çš„DB-less æ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯with a Database æ¨¡å¼ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ç¬¬äºŒç§å¸¦Databaseçš„æ¨¡å¼ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼åŠŸèƒ½æ›´å…¨ã€‚</p>
<h3 id="31-æ„å»ºkongçš„å®¹å™¨ç½‘ç»œ">3.1 æ„å»ºKongçš„å®¹å™¨ç½‘ç»œ</h3>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªDockerè‡ªå®šä¹‰ç½‘ç»œï¼Œä»¥å…è®¸å®¹å™¨ç›¸äº’å‘ç°å’Œé€šä¿¡ã€‚åœ¨ä¸‹é¢çš„åˆ›å»ºå‘½ä»¤ä¸­<code>kong-net</code>æ˜¯æˆ‘ä»¬åˆ›å»ºçš„Dockerç½‘ç»œåç§°ã€‚</p>
<pre><code class="language-docker">docker network create kong-net
</code></pre>
<h3 id="32-æ­å»ºæ•°æ®åº“ç¯å¢ƒ">3.2 æ­å»ºæ•°æ®åº“ç¯å¢ƒ</h3>
<p>Kong ç›®å‰ä½¿ç”¨Cassandra(Facebookå¼€æºçš„åˆ†å¸ƒå¼çš„NoSQLæ•°æ®åº“) æˆ–è€…PostgreSql,ä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸­çš„ä¸€ä¸ªæ¥é€‰æ‹©ä½ çš„Databaseã€‚è¯·æ³¨æ„å®šä¹‰ç½‘ç»œ <code>--network=kong-net</code> ã€‚</p>
<ul>
<li>Cassandraå®¹å™¨ï¼š</li>
</ul>
<pre><code class="language-undefined">docker run -d --name kong-database \
--network=kong-net \
-p 9042:9042 \
cassandra:3
</code></pre>
<ul>
<li>PostgreSQLå®¹å™¨ï¼š</li>
</ul>
<pre><code class="language-bash">docker run -d --name kong-database \
               --network=kong-net \
               -p 5432:5432 \
               -e &quot;POSTGRES_USER=kong&quot; \
               -e &quot;POSTGRES_DB=kong&quot; \
               -e &quot;POSTGRES_PASSWORD=kong&quot; \
               postgres:9.6

</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯PostgreSQLï¼Œæƒ³æŒ‚è½½å·æŒä¹…åŒ–æ•°æ®åˆ°å®¿ä¸»æœºã€‚é€šè¿‡ <code>-v</code> å‘½ä»¤æ˜¯ä¸å¥½ç”¨çš„ã€‚è¿™é‡Œæ¨èä½ ä½¿ç”¨ <code>docker volume create</code> å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæŒ‚è½½ã€‚</p>
<pre><code class="language-undefined">docker volume create kong-volume
</code></pre>
<p>ç„¶åä¸Šé¢çš„PostgreSQLå°±å¯ä»¥é€šè¿‡<code>- v kong-volume:/var/lib/postgresql/data</code> è¿›è¡ŒæŒ‚è½½äº†ã€‚</p>
<pre><code class="language-kotlin">docker run -d --name kong-database \
--network=kong-net \
-p 5432:5432 \
-v kong-volume:/var/lib/postgresql/data \
-e &quot;POSTGRES_USER=kong&quot; \
-e &quot;POSTGRES_DB=kong&quot; \
-e &quot;POSTGRES_PASSWORD=kong&quot; \
postgres:9.6
</code></pre>
<h3 id="33-åˆå§‹åŒ–æˆ–è€…è¿ç§»æ•°æ®åº“">3.3 åˆå§‹åŒ–æˆ–è€…è¿ç§»æ•°æ®åº“</h3>
<p>æˆ‘ä»¬ä½¿ç”¨<code>docker run --rm</code>æ¥åˆå§‹åŒ–æ•°æ®åº“ï¼Œè¯¥å‘½ä»¤æ‰§è¡Œåä¼šé€€å‡ºå®¹å™¨è€Œä¿ç•™å†…éƒ¨çš„æ•°æ®å·ï¼ˆvolumeï¼‰ã€‚</p>
<pre><code class="language-bash">docker run --rm \
     --network=kong-net \
     -e &quot;KONG_DATABASE=postgres&quot; \
     -e &quot;KONG_PG_HOST=kong-database&quot; \
     -e &quot;KONG_PG_USER=kong&quot; \
     -e &quot;KONG_PG_PASSWORD=kong&quot; \
     -e &quot;KONG_CASSANDRA_CONTACT_POINTS=kong-database&quot; \
     kong:latest kong migrations bootstrap
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤æˆ‘ä»¬è¿˜æ˜¯è¦æ³¨æ„çš„ï¼Œä¸€å®šè¦è·Ÿä½ å£°æ˜çš„ç½‘ç»œï¼Œæ•°æ®åº“ç±»å‹ã€hoståç§°ä¸€è‡´ã€‚åŒæ—¶æ³¨æ„Kongçš„ç‰ˆæœ¬å·ï¼Œæœ¬æ–‡æ˜¯åœ¨<code>Kong 1.4.x</code> ç‰ˆæœ¬ä¸‹å®Œæˆçš„ã€‚</p>
<p>å‡ºç°ä»¥ä¸‹å‘½ä»¤åˆ™å®Œæˆ</p>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594395292-image-20200710233451663.png" alt="image-20200710233451663" loading="lazy"></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®åº“ä¸­å·²ç»æœ‰è¡¨å‡ºç°äº†</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594395338-image-20200710233537744.png" alt="image-20200710233537744" loading="lazy"></figure>
<h3 id="34-å¯åŠ¨kongå®¹å™¨">3.4 å¯åŠ¨Kongå®¹å™¨</h3>
<p>3.3æ­¥éª¤å®Œæˆåˆå§‹åŒ–æˆ–è€…è¿ç§»æ•°æ®åº“åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªè¿æ¥åˆ°æ•°æ®åº“å®¹å™¨çš„Kongå®¹å™¨ï¼Œè¯·åŠ¡å¿…ä¿è¯ä½ çš„æ•°æ®åº“å®¹å™¨å¯åŠ¨çŠ¶æ€ï¼ŒåŒæ—¶æ£€æŸ¥æ‰€æœ‰çš„ç¯å¢ƒå‚æ•° <code>-e</code> æ˜¯å¦æ˜¯ä½ å®šä¹‰çš„ç¯å¢ƒã€‚</p>
<pre><code class="language-bash">docker run -d --name kong \
 --network=kong-net \
 -e &quot;KONG_DATABASE=postgres&quot; \
 -e &quot;KONG_PG_HOST=kong-database&quot; \
  -e &quot;KONG_PG_USER=kong&quot; \
  -e &quot;KONG_PG_PASSWORD=kong&quot; \
 -e &quot;KONG_CASSANDRA_CONTACT_POINTS=kong-database&quot; \
 -e &quot;KONG_PROXY_ACCESS_LOG=/dev/stdout&quot; \
 -e &quot;KONG_ADMIN_ACCESS_LOG=/dev/stdout&quot; \
 -e &quot;KONG_PROXY_ERROR_LOG=/dev/stderr&quot; \
 -e &quot;KONG_ADMIN_ERROR_LOG=/dev/stderr&quot; \
 -e &quot;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl&quot; \
 -p 8000:8000 \
 -p 8443:8443 \
 -p 8001:8001 \
 -p 8444:8444 \
 kong:latest
</code></pre>
<h3 id="35-éªŒè¯">3.5 éªŒè¯</h3>
<p>å¯é€šè¿‡ <code>curl -i &lt;wiz_tmp_plugin_tag id=&quot;wizKMHighlighterSpan_t_t&quot; style=&quot;color: rgb(0, 0, 0); cursor: pointer; border-bottom-width: 1px; border-bottom-color: rgb(0, 0, 204); border-bottom-style: dashed; background-color: rgb(234, 188, 244);&quot;&gt;http&lt;/wiz_tmp_plugin_tag&gt;://localhost:8001/</code> æˆ–è€…æµè§ˆå™¨è°ƒç”¨ <code>http://localhost:8001/</code> æ¥éªŒè¯Kong Admin æ˜¯å¦è”é€š ã€‚</p>
<h2 id="4-å®‰è£…kong-ç®¡ç†ui">4. å®‰è£…Kong ç®¡ç†UI</h2>
<p>Kong ä¼ä¸šç‰ˆæä¾›äº†ç®¡ç†UIï¼Œå¼€æºç‰ˆæœ¬æ˜¯æ²¡æœ‰çš„ã€‚ä½†æ˜¯æœ‰å¾ˆå¤šçš„å¼€æºçš„ç®¡ç† UI ï¼Œå…¶ä¸­æ¯”è¾ƒå¥½ç”¨çš„æ˜¯Kongaã€‚é¡¹ç›®åœ°å€ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fpantsel%2Fkonga">https://github.com/pantsel/konga</a></p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594394999-webp-20200710232958808.jpg" alt="img" loading="lazy"></figure>
<h3 id="41-konga-ç‰¹æ€§">4.1 Konga ç‰¹æ€§</h3>
<p>Konga ä¸»è¦æ˜¯ç”¨ AngularJS å†™çš„ï¼Œè¿è¡ŒäºnodejsæœåŠ¡ç«¯ã€‚å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>ç®¡ç†æ‰€æœ‰Kong Admin APIå¯¹è±¡ã€‚</li>
<li>æ”¯æŒä»è¿œç¨‹æºï¼ˆæ•°æ®åº“ï¼Œæ–‡ä»¶ï¼ŒAPIç­‰ï¼‰å¯¼å…¥ä½¿ç”¨è€…ã€‚</li>
<li>ç®¡ç†å¤šä¸ªKongèŠ‚ç‚¹ã€‚ä½¿ç”¨å¿«ç…§å¤‡ä»½ï¼Œè¿˜åŸå’Œè¿ç§»KongèŠ‚ç‚¹ã€‚</li>
<li>ä½¿ç”¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥ç›‘è§†èŠ‚ç‚¹å’ŒAPIçŠ¶æ€ã€‚</li>
<li>æ”¯æŒç”µå­é‚®ä»¶å’Œé—²ç½®é€šçŸ¥ã€‚</li>
<li>æ”¯æŒå¤šç”¨æˆ·ã€‚</li>
<li>æ˜“äºæ•°æ®åº“é›†æˆï¼ˆMySQLï¼ŒpostgresSQLï¼ŒMongoDBï¼ŒSQL Serverï¼‰ã€‚</li>
</ul>
<h3 id="42-dockerå®‰è£…konga">4.2 dockerå®‰è£…Konga</h3>
<p>æˆ‘ä»¬ä»Šå¤©é€šè¿‡Dockeræ¥å®‰è£…Kongaã€‚å®‰è£…æ­¥éª¤åŒæ ·éµå¾ªé…ç½®æ•°æ®åº“ï¼Œåˆå§‹åŒ–æ•°æ®åº“ï¼Œå¯åŠ¨å®¹å™¨çš„æµç¨‹ã€‚</p>
<h4 id="421-kongaæ•°æ®åº“å®¹å™¨">4.2.1 Kongaæ•°æ®åº“å®¹å™¨</h4>
<p>ä¸Šé¢åœ¨4.1ç‰¹æ€§ä»‹ç»ä¸­æˆ‘ä»¬ä»‹ç»äº†Kongaæ”¯æŒçš„æ•°æ®åº“ç±»å‹ã€‚è¿™é‡Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨PostgreSQLã€‚è¯·æ³¨æ„æˆ‘æ–°å®šä¹‰äº†æŒ‚è½½å·<code>konga-postgresql</code> ã€‚</p>
<pre><code class="language-undefined"> docker volume create konga-postgresql
</code></pre>
<pre><code class="language-kotlin">docker run -d --name konga-database \
--network=kong-net \
-p 5431:5432 \
-v konga-postgresql:/var/lib/postgresql/data \
-e &quot;POSTGRES_USER=kong&quot; \
-e &quot;POSTGRES_DB=konga&quot; \
-e &quot;POSTGRES_PASSWORD=kong&quot; \
postgres:9.6
</code></pre>
<h3 id="422-åˆå§‹åŒ–kongaæ•°æ®åº“">4.2.2 åˆå§‹åŒ–Kongaæ•°æ®åº“</h3>
<p>åˆå§‹åŒ– PostgreSQL æ•°æ®åº“ã€‚</p>
<pre><code>docker run --rm  --network=kong-net  pantsel/konga -c prepare -a postgres -u postgresql://kong:kong@konga-database:5432/konga_db
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤</p>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594433834-image-20200711101712846.png" alt="image-20200711101712846" loading="lazy"></figure>
<p>ç„¶åçœ‹æˆ‘ä»¬æœ¬åœ°ç«¯å£5431postgresqlä¸­æŸ¥çœ‹åº“</p>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594433882-image-20200711101802174.png" alt="image-20200711101802174" loading="lazy"></figure>
<p>ç›¸å…³å‘½ä»¤è§£è¯»ï¼š</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°</th>
<th>é»˜è®¤</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰§è¡Œçš„æ˜¯prepare</td>
<td>-</td>
</tr>
<tr>
<td>-a</td>
<td>adapter ç®€å†™ ï¼Œå¯ä»¥æ˜¯postgres æˆ–è€…mysql</td>
<td>-</td>
</tr>
<tr>
<td>-u</td>
<td>db url æ•°æ®åº“è¿æ¥å…¨ç§°</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>åˆ°æ­¤Kongaçš„æ•°æ®åº“ç¯å¢ƒå°±æå®šäº†ã€‚</p>
<h3 id="423-ç¯å¢ƒå‚æ•°">4.2.3 ç¯å¢ƒå‚æ•°</h3>
<p>Konga è¿˜æœ‰ä¸€äº›å¯é…ç½®çš„ç¯å¢ƒå‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>VAR</th>
<th>DESCRIPTION</th>
<th>VALUES</th>
<th>DEFAULT</th>
</tr>
</thead>
<tbody>
<tr>
<td>HOST</td>
<td>The IP address that will be bind by Konga's server</td>
<td>-</td>
<td>'0.0.0.0'</td>
</tr>
<tr>
<td>PORT</td>
<td>The port that will be used by Konga's server</td>
<td>-</td>
<td>1337</td>
</tr>
<tr>
<td>NODE_ENV</td>
<td>The environment</td>
<td><code>production</code>,<code>development</code></td>
<td><code>development</code></td>
</tr>
<tr>
<td>SSL_KEY_PATH</td>
<td>If you want to use SSL, this will be the absolute path to the .key file. Both <code>SSL_KEY_PATH</code> &amp; <code>SSL_CRT_PATH</code> must be set.</td>
<td>-</td>
<td>null</td>
</tr>
<tr>
<td>SSL_CRT_PATH</td>
<td>If you want to use SSL, this will be the absolute path to the .crt file. Both <code>SSL_KEY_PATH</code> &amp; <code>SSL_CRT_PATH</code> must be set.</td>
<td>-</td>
<td>null</td>
</tr>
<tr>
<td>KONGA_HOOK_TIMEOUT</td>
<td>The time in ms that Konga will wait for startup tasks to finish before exiting the process.</td>
<td>-</td>
<td>60000</td>
</tr>
<tr>
<td>DB_ADAPTER</td>
<td>The database that Konga will use. If not set, the localDisk db will be used.</td>
<td><code>mongo</code>,<code>mysql</code>,<code>postgres</code></td>
<td>-</td>
</tr>
<tr>
<td>DB_URI</td>
<td>The full db connection string. Depends on <code>DB_ADAPTER</code>. If this is set, no other DB related var is needed.</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>DB_HOST</td>
<td>If <code>DB_URI</code> is not specified, this is the database host. Depends on <code>DB_ADAPTER</code>.</td>
<td>-</td>
<td>localhost</td>
</tr>
<tr>
<td>DB_PORT</td>
<td>If <code>DB_URI</code> is not specified, this is the database port. Depends on <code>DB_ADAPTER</code>.</td>
<td>-</td>
<td>DB default.</td>
</tr>
<tr>
<td>DB_USER</td>
<td>If <code>DB_URI</code> is not specified, this is the database user. Depends on <code>DB_ADAPTER</code>.</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>DB_PASSWORD</td>
<td>If <code>DB_URI</code> is not specified, this is the database user's password. Depends on <code>DB_ADAPTER</code>.</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>DB_DATABASE</td>
<td>If <code>DB_URI</code> is not specified, this is the name of Konga's db. Depends on <code>DB_ADAPTER</code>.</td>
<td>-</td>
<td><code>konga_database</code></td>
</tr>
<tr>
<td>DB_PG_SCHEMA</td>
<td>If using postgres as a database, this is the schema that will be used.</td>
<td>-</td>
<td><code>public</code></td>
</tr>
<tr>
<td>KONGA_LOG_LEVEL</td>
<td>The logging level</td>
<td><code>silly</code>,<code>debug</code>,<code>info</code>,<code>warn</code>,<code>error</code></td>
<td><code>debug</code> on dev environment &amp; <code>warn</code> on prod.</td>
</tr>
<tr>
<td>TOKEN_SECRET</td>
<td>The secret that will be used to sign JWT tokens issued by Konga</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>NO_AUTH</td>
<td>Run Konga without Authentication</td>
<td>true/false</td>
<td>-</td>
</tr>
<tr>
<td>BASE_URL</td>
<td>Define a base URL or relative path that Konga will be loaded from. Ex: <a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.example.com%2Fkonga">www.example.com/konga</a></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>KONGA_SEED_USER_DATA_SOURCE_FILE</td>
<td>Seed default users on first run. <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fpantsel%2Fkonga%2Fblob%2Fmaster%2Fdocs%2FSEED_DEFAULT_DATA.md">Docs</a>.</td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>KONGA_SEED_KONG_NODE_DATA_SOURCE_FILE</td>
<td>Seed default Kong Admin API connections on first run <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fpantsel%2Fkonga%2Fblob%2Fmaster%2Fdocs%2FSEED_DEFAULT_DATA.md">Docs</a></td>
<td></td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="424-å¯åŠ¨konga">4.2.4 å¯åŠ¨Konga</h3>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥å¯åŠ¨Kongaå®¹å™¨äº†</p>
<pre><code class="language-bash">docker run -d -p 1337:1337  \
               --network kong-net  \
               -e &quot;DB_ADAPTER=postgres&quot;  \
               -e &quot;DB_URI=postgres://kong:kong@konga-database:5432/konga_db&quot;  \
               -e &quot;NODE_ENV=production&quot;  \
               -e &quot;DB_PASSWORD=konga&quot; \
               --name konga \
               pantsel/konga
</code></pre>
<p>è¿è¡Œå®Œåï¼Œå¦‚æœæˆåŠŸå¯ä»¥é€šè¿‡<code>http://localhost:1337</code> é“¾æ¥åˆ°æ§åˆ¶å°ã€‚é€šè¿‡æ³¨å†Œåè¿›å…¥ï¼Œç„¶ååœ¨dashboardé¢æ¿é‡Œé¢æ·»åŠ Kongçš„ç®¡ç†Apiè·¯å¾„<code>http://yourdomain</code> ã€‚è¿™é‡Œæ·»åŠ dockeråˆ«å <code>http://kong:8001</code> ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1594434815-image-20200711103334311.png" alt="image-20200711103334311" loading="lazy"></figure>
<h2 id="æœ¬æ–‡å‚è€ƒ">æœ¬æ–‡å‚è€ƒ</h2>
<ul>
<li><a href="https://www.yisu.com/zixun/6962.html">dockerå®¹å™¨æ­å»ºkong-dashboardæˆ–konga</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[javaæ— æ³•è¿æ¥7.7.1ç‰ˆæœ¬elasticsearch]]></title>
        <id>https://Nobodylesszb.github.io/post/VR3BsE0kU/</id>
        <link href="https://Nobodylesszb.github.io/post/VR3BsE0kU/">
        </link>
        <updated>2020-06-18T06:39:02.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æœ€è¿‘åœ¨å­¦ä¹ esçš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œç‰¹æ¥è®°å½•ä¸€ä¸‹</p>
</blockquote>
<h2 id="å‰åº">å‰åº</h2>
<p>å› ä¸ºç¬”è€…æ˜¯macç¬”è®°æœ¬ï¼Œæ‰€ä»¥ç›´æ¥ç”¨brewå®‰è£…çš„<code>elasticsearch</code>,æ˜¯7.7.1ç‰ˆæœ¬</p>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1592460685-image-20200618141122805.png" alt="image-20200618141122805" loading="lazy"></figure>
<p>æŸ¥çœ‹esçš„<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">å®˜ç½‘æ–‡æ¡£</a>å¯ä»¥çœ‹åˆ°7.7.1ç‰ˆæœ¬çš„mavenä¾èµ–ï¼Œå®˜æ–¹æ¨èä½¿ç”¨<code>high-level</code>çš„ç‰ˆæœ¬</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
    &lt;version&gt;7.7.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>ç„¶åæˆ‘ä»¬å†çœ‹ä»–çš„åˆå§‹åŒ–é…ç½®</p>
<pre><code class="language-java">RestHighLevelClient client = new RestHighLevelClient(
        RestClient.builder(
                new HttpHost(&quot;localhost&quot;, 9200, &quot;http&quot;),
                new HttpHost(&quot;localhost&quot;, 9201, &quot;http&quot;)));
</code></pre>
<p>æˆ‘ä»¬åœ¨javaé¡¹ç›®ä¸­å†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå¦‚ä¸‹</p>
<pre><code class="language-java">@Configuration
public class GulimallElasticSearchConfig {

    @Bean
    public RestHighLevelClient esRestClient(){
        RestHighLevelClient client = new RestHighLevelClient(
                RestClient.builder(new HttpHost(&quot;localhost&quot;, 9200, &quot;http&quot;)));
        return  client;
    }
}
</code></pre>
<p>ç„¶ååŸºæœ¬çš„ymlé…ç½®</p>
<pre><code class="language-yml">server:
  port:9001


spring:
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
  application:
    name: search
</code></pre>
<p>ç„¶åå¯åŠ¨</p>
<pre><code class="language-java">org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'esRestClient' defined in class path resource [com/atguigu/gulimall/search/config/GulimallElasticSearchConfig.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.elasticsearch.client.RestHighLevelClient]: Factory method 'esRestClient' threw exception; nested exception is java.lang.NoSuchFieldError: IGNORE_DEPRECATIONS
	
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1592461149-image-20200618141907712.png" alt="image-20200618141907712" loading="lazy"></figure>
<p>å‘ç°å…¶æŠ¥é”™äº†</p>
<p>å…¶ä¸­æœ€ä¸»è¦çš„ä¸€å¥æŠ¥é”™å°±æ˜¯</p>
<p><strong>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'esRestClient' defined in class path resource [com/atguigu/gulimall/search/config/GulimallElasticSearchConfig.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.elasticsearch.client.RestHighLevelClient]: Factory method 'esRestClient' threw exception; nested exception is java.lang.NoSuchFieldError: IGNORE_DEPRECATIONS</strong></p>
<h2 id="è§£å†³">è§£å†³</h2>
<p>ç¬”è€…æŸ¥çœ‹äº†ä¸€äº›stackoverflow,<a href="https://stackoverflow.com/questions/62338588/spring-boot-with-elastic-search-causing-java-lang-nosuchfielderror-ignore-depre">å…·ä½“ç½‘å€</a></p>
<p>ä¸ä»…éœ€è¦åŠ è¿™ä¸ªä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
    &lt;version&gt;7.7.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>ä»ç„¶éœ€è¦åŠ è¿™ä¸¤ä¸ªä¾èµ–</p>
<pre><code class="language-xml">		&lt;dependency&gt;
            &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
            &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt;
            &lt;version&gt;7.7.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
            &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;
            &lt;version&gt;7.7.1&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<p>ç„¶åé‡æ–°cleanï¼Œinstallï¼Œé‡å¯</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1592462290-image-20200618143808157.png" alt="image-20200618143808157" loading="lazy"></figure>
<p>å¯è§å·²ç»å¯åŠ¨</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Cloud Eurekaï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°]]></title>
        <id>https://Nobodylesszb.github.io/post/uGJMQ57dS/</id>
        <link href="https://Nobodylesszb.github.io/post/uGJMQ57dS/">
        </link>
        <updated>2020-04-07T14:58:54.000Z</updated>
        <content type="html"><![CDATA[<h1 id="spring-cloud-eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°">Spring Cloud Eurekaï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°</h1>
<h2 id="æ‘˜è¦">æ‘˜è¦</h2>
<p>Spring Cloud Eurekaæ˜¯Spring Cloud Netflix å­é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æ²»ç†ã€‚ æœ¬æ–‡å°†å¯¹æ­å»ºEurekaæ³¨å†Œä¸­å¿ƒï¼Œæ­å»ºEurekaå®¢æˆ·ç«¯ï¼Œæ­å»ºEurekaé›†ç¾¤åŠç»™Eurekaæ³¨å†Œä¸­å¿ƒæ·»åŠ ç™»å½•è®¤è¯è¿›è¡Œä»‹ç»ã€‚</p>
<h2 id=""></h2>
<h2 id="eurekaç®€ä»‹">Eurekaç®€ä»‹</h2>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¾€å¾€ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå‘æ³¨å†Œä¸­å¿ƒå»æ³¨å†Œè‡ªå·±çš„åœ°å€åŠç«¯å£ä¿¡æ¯ï¼Œæ³¨å†Œä¸­å¿ƒç»´æŠ¤ç€æœåŠ¡åç§°ä¸æœåŠ¡å®ä¾‹çš„å¯¹åº”å…³ç³»ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå®šæ—¶ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨ï¼ŒåŒæ—¶æ±‡æŠ¥è‡ªå·±çš„è¿è¡Œæƒ…å†µï¼Œè¿™æ ·å½“æœ‰çš„æœåŠ¡éœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶ï¼Œå°±å¯ä»¥ä»è‡ªå·±è·å–åˆ°çš„æœåŠ¡åˆ—è¡¨ä¸­è·å–å®ä¾‹åœ°å€è¿›è¡Œè°ƒç”¨ï¼ŒEurekaå®ç°äº†è¿™å¥—æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ã€‚</p>
<h3 id="æ­å»ºeurekaæ³¨å†Œä¸­å¿ƒ">æ­å»ºEurekaæ³¨å†Œä¸­å¿ƒ</h3>
<ul>
<li>å¡«å†™åº”ç”¨ä¿¡æ¯</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1586261155-image-20200407200555211.png" alt="image-20200407200555211" loading="lazy"></figure>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©springcloudç»„ä»¶è¿›è¡Œåˆ›å»º</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1586261174-image-20200407200614074.png" alt="image-20200407200614074" loading="lazy"></figure>
<ul>
<li>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableEurekaServeræ³¨è§£æ¥å¯ç”¨Euerkaæ³¨å†Œä¸­å¿ƒåŠŸèƒ½</li>
</ul>
<pre><code class="language-java">@EnableEurekaServer
@SpringBootApplication
public class EurekaServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }

}

</code></pre>
<ul>
<li>åœ¨é…ç½®æ–‡ä»¶application.ymlä¸­æ·»åŠ Eurekaæ³¨å†Œä¸­å¿ƒçš„é…ç½®,è¿™é‡Œä¸€å…±é…ç½®ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒã€‚ç«¯å£åˆ†åˆ«ä¸º8761,8762,8763ï¼Œä¸¤ä¸¤ç›¸äº’æ³¨å†Œ</li>
</ul>
<pre><code class="language-yml">//application.ymlæ–‡ä»¶
spring:
  profiles:
    active: eureka1
    
//application-eureka1.yml
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8762/eureka/,http://localhost:8763/eureka/
  register-with-eureka: false
  fetchRegistry: false
  server:
    enable-self-preservation: false
spring:
  application:
    name: eureka
server:
  port: 8761
</code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>server.port: æŒ‡æ˜äº†åº”ç”¨å¯åŠ¨çš„ç«¯å£å·</li>
<li>eureka.instance.hostname: åº”ç”¨çš„ä¸»æœºåç§°</li>
<li>eureka.client.registerWithEureka: å€¼ä¸º<code>false</code>æ„å‘³ç€è‡ªèº«ä»…ä½œä¸ºæœåŠ¡å™¨ï¼Œä¸ä½œä¸ºå®¢æˆ·ç«¯</li>
<li>eureka.client.fetchRegistry: å€¼ä¸º<code>false</code>æ„å‘³ç€æ— éœ€æ³¨å†Œè‡ªèº«</li>
<li>eureka.client.serviceUrl.defaultZone: æŒ‡æ˜äº†åº”ç”¨çš„URL</li>
</ul>
<p>å¸¸ç”¨çš„EurekaæœåŠ¡é…ç½®</p>
<pre><code class="language-yml">eureka:
  client: #eurekaå®¢æˆ·ç«¯é…ç½®
    register-with-eureka: true #æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°eurekaæœåŠ¡ç«¯ä¸Šå»
    fetch-registry: true #æ˜¯å¦è·å–eurekaæœåŠ¡ç«¯ä¸Šæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨
    service-url:
      defaultZone: http://localhost:8001/eureka/ # æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€
    enabled: true # å¯ç”¨eurekaå®¢æˆ·ç«¯
    registry-fetch-interval-seconds: 30 #å®šä¹‰å»eurekaæœåŠ¡ç«¯è·å–æœåŠ¡åˆ—è¡¨çš„æ—¶é—´é—´éš”
  instance: #eurekaå®¢æˆ·ç«¯å®ä¾‹é…ç½®
    lease-renewal-interval-in-seconds: 30 #å®šä¹‰æœåŠ¡å¤šä¹…å»æ³¨å†Œä¸­å¿ƒç»­çº¦
    lease-expiration-duration-in-seconds: 90 #å®šä¹‰æœåŠ¡å¤šä¹…ä¸å»ç»­çº¦è®¤ä¸ºæœåŠ¡å¤±æ•ˆ
    metadata-map:
      zone: jiangsu #æ‰€åœ¨åŒºåŸŸ
    hostname: localhost #æœåŠ¡ä¸»æœºåç§°
    prefer-ip-address: false #æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ipæ¥ä½œä¸ºä¸»æœºå
  server: #eurekaæœåŠ¡ç«¯é…ç½®
    enable-self-preservation: false #å…³é—­eurekaæœåŠ¡ç«¯çš„ä¿æŠ¤æœºåˆ¶
</code></pre>
<p>ç„¶åä¾æ¬¡å¯åŠ¨æœåŠ¡</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1586270877-image-20200407224757214.png" alt="image-20200407224757214" loading="lazy"></figure>
<p>æºç åœ¨<a href="https://github.com/Nobodylesszb/springcloud-guider/tree/master/eureka-server">é“¾æ¥</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[dockeréƒ¨ç½²ä¸»ä»æ•°æ®åº“]]></title>
        <id>https://Nobodylesszb.github.io/post/a486-L6HE/</id>
        <link href="https://Nobodylesszb.github.io/post/a486-L6HE/">
        </link>
        <updated>2020-03-14T16:05:17.000Z</updated>
        <content type="html"><![CDATA[<h3 id="ä¸‹è½½docker">ä¸‹è½½docker</h3>
<p>ç¬”è€…æ˜¯macç‰ˆæœ¬çš„dockerï¼Œä¸‹è½½å®˜ç½‘æ˜¯<a href="https://hub.docker.com/">å®˜ç½‘</a>,è¯·å„ä½è‡ªè¡Œä¸‹è½½</p>
<h3 id="å¼€å¯k8s">å¼€å¯k8s</h3>
<p>ç¬”è€…åœ¨å¼€å¯k8sçš„æ—¶å€™æ€»æ˜¯æ˜¾ç¤º<code>starting</code>ä½†æ˜¯å°±æ˜¯å¯åŠ¨ä¸èµ·æ¥ã€‚ä¸€ç•ªæŸ¥æ‰¾ä¹‹åæ‰¾åˆ°äº†åŸå› ï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå¯åŠ¨ Kubernetes æ‰€éœ€çš„é•œåƒå¾€å¾€ä¼šä¸‹è½½å¤±è´¥ï¼Œäºæ˜¯ç‚¹å‡» <em>Apply</em> åï¼Œè¯¥é…ç½®é¡µé¢çš„å³ä¸‹è§’å§‹ç»ˆæ˜¾ç¤º <em>Kubernetes is starting</em>ï¼Œæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚</p>
<p><a href="https://github.com/maguowei/k8s-docker-desktop-for-mac">Docker Desktop for Mac å¼€å¯å¹¶ä½¿ç”¨ Kubernetes</a> ä¸ºè¯¥é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬å…ˆå°†è¯¥ä»“åº“æ‹‰å–åˆ°æœ¬åœ°ï¼š</p>
<pre><code class="language-bash">git clone git@github.com:maguowei/k8s-docker-desktop-for-mac.git
</code></pre>
<p>ç„¶åç¡®è®¤ä¸€ä¸‹ Docker Desktop è‡ªå¸¦çš„ Kubernetes çš„ç‰ˆæœ¬ã€‚ç‚¹å‡» Docker å›¾æ ‡ï¼Œé€‰æ‹© <em>About Docker Desktop</em>ï¼Œçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584201976-image-20200314214514924.png" alt="image-20200314214514924" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ° Kubernetes çš„ç‰ˆæœ¬æ˜¯ v1.15.5ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸‹é¢å‘½ä»¤åˆ‡æ¢ <a href="https://github.com/AliyunContainerService/k8s-for-docker-desktop/tree/v1.15.5">v1.15.5 åˆ†æ”¯</a> <code>git checkout v1.15.5</code></p>
<p>åœ¨ Mac ä¸Šæ‰§è¡Œå¦‚ä¸‹è„šæœ¬</p>
<pre><code class="language-bash">./load_images.sh
</code></pre>
<p>ç­‰å¾…æ›´æ¢å®Œæˆ</p>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584193774-image-20200314214933763.png" alt="image-20200314214933763" loading="lazy"></figure>
<p>ç„¶åé‡å¯dockerå¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸå¯åŠ¨</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584193847-image-20200314215047476.png" alt="image-20200314215047476" loading="lazy"></figure>
<h3 id="åˆ›å»ºmysql-3307master">åˆ›å»ºmysql-3307ï¼ˆmasterï¼‰</h3>
<p>æˆ‘ä»¬å…ˆæ‹‰å»mysqlæœ€è¿‘é•œåƒæ–‡ä»¶<code>docker pull mysql:latest</code></p>
<p>ç„¶ååœ¨/docker/mysql/mysql-3307ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶å¤¹ï¼Œç¬”è€…åˆ›å»ºäº†ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œdataï¼šç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œconf:ç”¨æ¥é…ç½®mysqlé…ç½®ï¼Œbash:ç”¨æ¥å­˜æ”¾å¼€å¯å‘½ä»¤</p>
<pre><code class="language-bash"> mkdir -p /docker/mysql/mysql-3308/conf
 mkdir -p /docker/mysql/mysql-3308/mysql-files
 mkdir -p /docker/mysql/mysql-3308/data
 cd /docker/mysql/mysql-3308/conf
</code></pre>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå›¾ä¸­çš„mysql-3307.cnf</p>
<pre><code class="language-xml">[mysqld]
user=mysql
character-set-server=utf8mb4
default_authentication_plugin=mysql_native_password
[client]
default-character-set=utf8mb4
[mysql]
default-character-set=utf8mb4
[mysqld]
port=3307
</code></pre>
<p><strong>åˆ‡è®°</strong>è¿è¡Œmysqlå‘½ä»¤ä¹‹å‰ï¼Œå…ˆå°†ä½ çš„é…ç½®æ–‡ä»¶è·¯å¾„æ”¾åˆ°dockerè®¾ç½®ä¸­<code>FILE SHARING</code>ä¸­ï¼Œç„¶åé‡å¯</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584194766-image-20200314220605825.png" alt="image-20200314220605825" loading="lazy"></figure>
<p>ç„¶åå¼€å¯mysql</p>
<pre><code class="language-bash">docker run -d -p 3307:3307 --privileged=true -v /docker/mysql/mysql-3307/conf/my-3307.cnf:/etc/mysql/my.cnf -v /docker/mysql/mysql-3307/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql-3307 mysql:latest
</code></pre>
<p>å‚æ•°è¯´æ˜</p>
<ul>
<li>
<p>-p 3307:3307:ç«¯å£æ˜ å°„ï¼Œå°†æœ¬åœ°3307ç«¯å£æ˜ å°„åˆ°mysql3307ç«¯å£</p>
</li>
<li>
<p>--privileged=trueï¼šå®¹å™¨å†…çš„rootæ‹¥æœ‰çœŸæ­£rootæƒé™ï¼Œå¦åˆ™å®¹å™¨å†…rootåªæ˜¯å¤–éƒ¨æ™®é€šç”¨æˆ·æƒé™</p>
</li>
<li>
<p>-v /docker/mysq/mysql-3307/conf/my-3307.cnf:/etc/mysql/my.cnfï¼šæ˜ å°„é…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>-v /docker/mysql/mysql-3307/data:/var/lib/mysqlï¼šæ˜ å°„æ•°æ®ç›®å½•</p>
</li>
<li>
<p>-e MYSQL_ROOT_PASSWORD=123456 :è®¾ç½®rootè´¦æˆ·å¯†ç 123456</p>
</li>
<li>
<p>--name mysql-3307ï¼šè®¾ç½®å®¹å™¨åç§°mysql-3307</p>
</li>
</ul>
<p>è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œmysqlæ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œæˆ‘ä»¬çœ‹åˆ°æ˜¯å› ä¸º/var/lib/mysql-fileï¼ŒæŸ¥è¯¢å¾—çŸ¥å½“æŒ‡å®šäº†å¤–éƒ¨é…ç½®æ–‡ä»¶ä¸å¤–éƒ¨å­˜å‚¨è·¯å¾„æ—¶ï¼Œä¹Ÿéœ€è¦æŒ‡å®š /var/lib/mysql-filesçš„å¤–éƒ¨ç›®å½•ï¼Œæ‰€ä»¥åœ¨ ä¸»æœºæ–°å»º/docker/mysql/mysql-3307/mysql-filesç›®å½•ï¼Œ</p>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584193350-image-20200314214230475.png" alt="image-20200314214230475" loading="lazy"></figure>
<p>é‡æ–°æ‰§è¡Œæ–°çš„å‘½ä»¤</p>
<pre><code class="language-bash">docker run -d -p 3307:3307 --privileged=true -v /docker/mysql/mysql-3307/conf/my-3307.cnf:/etc/mysql/my.cnf -v /docker/mysql/mysql-3307/data:/var/lib/mysql -v /docker/mysql/mysql-3307/mysql-files:/var/lib/mysql-files/ -e MYSQL_ROOT_PASSWORD=123456 --name mysql-3307 mysql:latest
e95e247dc96d547bf37b8ee388e9d351e196c4e92cee88441f74efd510527962 --é•œåƒ
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>docker ps</code> æ¥æŸ¥çœ‹è¿›ç¨‹,çŠ¶æ€æ˜¾ç¤ºupï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸå¯åŠ¨ï¼Œ</p>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584195715-image-20200314222155737.png" alt="image-20200314222155737" loading="lazy"></figure>
<p>æˆ‘ä»¬åœ¨ç”¨navicateè¿æ¥æµ‹è¯•ä¸€ä¸‹</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584195835-image-20200314222355460.png" alt="image-20200314222355460" loading="lazy"></figure>
<h3 id="åˆ›å»ºmysql-3308slave">åˆ›å»ºmysql-3308ï¼ˆslaveï¼‰</h3>
<p>å’Œå‰é¢çš„ä¸»åº“å·®ä¸å¤šï¼Œä¸è¿‡ä»åº“çš„é…ç½®æ–‡ä»¶å˜äº†</p>
<pre><code class="language-bash"> mkdir -p /docker/mysql/mysql-3308/conf
 mkdir -p /docker/mysql/mysql-3308/mysql-files
 mkdir -p /docker/mysql/mysql-3308/data
cd /docker/mysql/mysql-3308/conf
sudo touch my-3308.cnf
//mysql-3308.cnf
[mysqld]
user = mysql
character-set-server = utf8mb4
default_authentication_plugin = mysql_native_password

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
port=3308

docker run -d -p 3308:3308 --privileged=true -v /docker/mysql/mysql-3308/conf/my-3308.cnf:/etc/mysql/my.cnf -v /docker/mysql/mysql-3308/data:/var/lib/mysql -v /docker/mysql/mysql-3308/mysql-files:/var/lib/mysql-files/ -e MYSQL_ROOT_PASSWORD=123456 --name mysql-3308 mysql:latest


</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨<code>docker ps</code>æ¥æŸ¥çœ‹æ—¶å€™å¯åŠ¨</p>
<figure data-type="image" tabindex="8"><img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1584197839-image-20200314225719550.png" alt="image-20200314225719550" loading="lazy"></figure>
<h3 id="é…ç½®masterçš„slaveè®¿é—®ç”¨æˆ·">é…ç½®masterçš„slaveè®¿é—®ç”¨æˆ·</h3>
<pre><code class="language-bash">//è¿›å…¥mysql-3307çš„dockerå‘½ä»¤è¡Œ
sudo docker exec -it mysql-1 bash
mysql -uroot -p123456

mysql&gt; use mysql;
mysql&gt; select host, user, plugin from user;
+-----------+------------------+-----------------------+
| host      | user             | plugin                |
+-----------+------------------+-----------------------+
| %         | root             | mysql_native_password |
| localhost | mysql.infoschema | caching_sha2_password |
| localhost | mysql.session    | caching_sha2_password |
| localhost | mysql.sys        | caching_sha2_password |
| localhost | root             | mysql_native_password |
+-----------+------------------+-----------------------+
</code></pre>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸€ä¸‹ mysql8.0é»˜è®¤çš„èº«ä»½éªŒè¯æ’ä»¶æ˜¯ caching_sha2_password, æ—§ç‰ˆçš„navicatä¸æ”¯æŒè¿™ç§èº«ä»½éªŒè¯æ’ä»¶ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºmysql_native_password<br>
åœ¨MySQL 5.7ä¸­ï¼Œé»˜è®¤çš„èº«ä»½éªŒè¯æ’ä»¶æ˜¯ mysql_native_password !<br>
( ALTER USER â€˜rootâ€™@â€˜localhostâ€™ IDENTIFIED WITH mysql_native_password BY â€˜123456â€™; )</p>
</blockquote>
<p>ç”±äºæˆ‘ä»¬åœ¨é…ç½®ä¸­é¢„å…ˆè®¾ç½®äº†default_authentication_plugin = mysql_native_password<br>
æ‰€ä»¥é»˜è®¤rootçš„å¯†ç åŠ å¯†æ˜¯mysql_native_password</p>
<pre><code class="language-sql">//åˆ›å»ºslaveç”¨æˆ·
mysql&gt; CREATE USER 'slave_1'@'%' IDENTIFIED BY '123456';
Query OK, 0 rows affected (0.13 sec)
//ç»™æ–°ç”¨æˆ·æˆæƒ
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'slave_1'@'%';
Query OK, 0 rows affected (0.31 sec)
//åˆ·æ–°æƒé™
mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.02 sec)
</code></pre>
<h3 id="é…ç½®mysql-3307masterçš„-my-3307cnf">é…ç½®mysql-3307(master)çš„ my-3307.cnf</h3>
<p>è¿™è¾¹é…ç½®ä¸€ä¸‹mysql-3307å’Œmysql-3308çš„binlogè®¾ç½® ï¼Œå› ä¸ºmysqlå®é™…æ˜¯ä¼ è¾“binlog(äºŒè¿›åˆ¶æ—¥å¿—)æ¥è¾¾æˆå¤åˆ¶çš„,å…·ä½“çš„åŒæ­¥æµç¨‹å’ŒåŸç†å¯ä»¥ç™¾åº¦ä¸€ä¸‹</p>
<p>å› ä¸ºåˆ›å»ºdocker mysqlçš„æ—¶å€™å°±æŠŠ /docker/mysql/mysql-3307/conf/my-3307.cnf æ˜ å°„åˆ°äº† /etc/mysql/my.cnfé‡Œ,æ‰€ä»¥ç›´æ¥ä¿®æ”¹/docker/mysql/mysql-3307/conf/my-3307.cnf å†é‡å¯å°±å®Œäº‹äº†</p>
<pre><code class="language-bash">[mysqld]
user=mysql
character-set-server=utf8mb4
default_authentication_plugin=mysql_native_password
[client]
default-character-set=utf8mb4
[mysql]
default-character-set=utf8mb4
[mysqld]
port=3307

# è®¾å¤‡ç¼–å· ä¸èƒ½ä¸å…¶ä»–mysqlç›¸åŒ
server-id = 1
# å¼€å¯ binlog
log-bin = mysql-bin
# å¤åˆ¶çš„æ•°æ®åº“
binlog-do-db = test_school
# ä¸å¤åˆ¶çš„æ•°æ®åº“
binlog_ignore_db = mysql
# ä»å¤åˆ¶çš„æ ¼å¼ï¼ˆmixed,statement,rowï¼Œé»˜è®¤æ ¼å¼æ˜¯statementï¼‰
binlog-format = mixed
# äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨åˆ é™¤/è¿‡æœŸçš„å¤©æ•°ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨åˆ é™¤ã€‚
expire_logs_days = 7  
</code></pre>
<p>é‡å¯ä¸€ä¸‹mysql-3307(master)</p>
<pre><code class="language-sql">sudo docker restart mysql-1
sudo docker exec -it mysql-1 bash
mysql -uroot -p123456
mysql&gt; show master status;
+------------------+----------+--------------+-------------------------------------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB                                | Executed_Gtid_Set |
+------------------+----------+--------------+-------------------------------------------------+-------------------+
| mysql-bin.000001 |      155 | test_school  | sys,mysql,information_schema,performance_schema |                   |
+------------------+----------+--------------+-------------------------------------------------+-------------------+
1 row in set (0.00 sec)
</code></pre>
<p>å¯ä»¥çœ‹åˆ°mysql-3306(master)binlogç”Ÿæ•ˆäº†</p>
<h3 id="é…ç½®mysql-3308slaveçš„-mycnf">é…ç½®mysql-3308(slave)çš„ my.cnf</h3>
<p>åŒç†ä¿®æ”¹mysql-3308(slave)çš„é…ç½®æ–‡ä»¶</p>
<pre><code class="language-bash">[mysqld]
user = mysql
character-set-server = utf8mb4
default_authentication_plugin = mysql_native_password

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
port=3308

bind-address = 0.0.0.0

#skip-name-resolve

# è®¾å¤‡ç¼–å· ä¸èƒ½ä¸å…¶ä»–mysqlç›¸åŒ
server-id = 2
# å¼€å¯ binlog ä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒSlaveçš„Masteræ—¶ä½¿ç”¨
log-bin = mysql-slave1-bin
# å¤åˆ¶çš„æ•°æ®åº“
binlog-do-db = test_school
# ä¸å¤åˆ¶çš„æ•°æ®åº“
binlog_ignore_db = mysql
# ä»å¤åˆ¶çš„æ ¼å¼ï¼ˆmixed,statement,rowï¼Œé»˜è®¤æ ¼å¼æ˜¯statementï¼‰
binlog-format = mixed
# äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨åˆ é™¤/è¿‡æœŸçš„å¤©æ•°ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨åˆ é™¤ã€‚
expire_logs_days = 7

</code></pre>
<p>é…ç½®mysql-3308(slave)çš„mysqlåŒæ­¥ä¿¡æ¯</p>
<pre><code class="language-bash">sudo docker restart mysql-3308
sudo docker exec -it mysql-2 bash
mysql -uroot -p123456

//ä¿®æ”¹è¦åŒæ­¥çš„masterçš„é…ç½®, ç”¨ä¹‹å‰åœ¨mysql-3308(master)åˆ›å»ºçš„slave_1ç”¨æˆ·
mysql&gt; CHANGE MASTER TO
    -&gt; MASTER_HOST='*.*.*.*',
    -&gt; MASTER_USER='slave_1',
    -&gt; MASTER_PASSWORD='123456',
    -&gt; MASTER_PORT=33061,
    -&gt; MASTER_LOG_FILE='mysql-bin.000001',
    -&gt; MASTER_LOG_POS=155;
Query OK, 0 rows affected, 2 warnings (0.45 sec)
</code></pre>
<p>MASTER_LOG_FILE å°±æ˜¯masteré‡Œçš„File, MASTER_LOG_POSå°±æ˜¯masteré‡Œçš„Position</p>
<h3 id="å…³äºmster_hostçš„æŒ‡å‘é—®é¢˜">å…³äºMSTER_HOSTçš„æŒ‡å‘é—®é¢˜</h3>
<p>è¿™é‡Œæ˜¯ç”¨dockeråšçš„ä¸»ä»å¤åˆ¶ï¼Œå¿…é¡»è¦æ˜¯ç”¨å¤–ç½‘IPæ‰å¯ä»¥è¿æ¥ï¼Œå†…ç½‘IPæˆ–è€…localhostéƒ½æ˜¯ä¸è¡Œçš„ï¼ åœ¨dockeré‡Œé¢ç”¨å†…ç½‘IPè¿ä¸ä¸Šå¦ä¸€ä¸ªdockerçš„mysqlï¼Œå¿…è¦è¦ç”¨å¤–ç½‘IPï¼Œå¤–ç½‘IPï¼Œå¤–ç½‘IPï¼</p>
<h3 id="æŸ¥çœ‹åŒæ­¥çŠ¶æ€">æŸ¥çœ‹åŒæ­¥çŠ¶æ€</h3>
<p>å…ˆå¼€å¯ slave</p>
<pre><code class="language-sql">mysql&gt; start slave;
Query OK, 0 rows affected (0.02 sec)

mysql&gt; show slave status 
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: *.*.*.*
                  Master_User: slave_1
                  Master_Port: 33061
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000003
          Read_Master_Log_Pos: 155
               Relay_Log_File: 1675298fc92a-relay-bin.000004
                Relay_Log_Pos: 369
        Relay_Master_Log_File: mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
            ...

1 row in set (0.00 sec)
</code></pre>
<p>çœ‹åˆ° Slave_IO_Running, Slave_SQL_Running éƒ½ä¸ºYESçš„æƒ…å†µ å°±æ˜¯ä¸»ä»å¤åˆ¶è®¾ç½®æˆåŠŸäº†<br>
å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ä¸»åº“è¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œçœ‹çœ‹ä»åº“æ˜¯å¦æœ‰åŒæ­¥</p>
<p>è¿™é‡Œæœ‰å¯èƒ½å­˜åœ¨çš„é”™è¯¯ï¼š</p>
<ul>
<li>
<p>ç½‘ç»œä¸é€š</p>
</li>
<li>
<p>è´¦å·å¯†ç é”™è¯¯</p>
</li>
<li>
<p>master_log_file æˆ–è€… master_log_pos é”™è¯¯</p>
</li>
<li>
<p>ç«¯å£æœªå¼€æ”¾ï¼ˆé˜²ç«å¢™ï¼‰</p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨]]></title>
        <id>https://Nobodylesszb.github.io/post/rabbitmq/</id>
        <link href="https://Nobodylesszb.github.io/post/rabbitmq/">
        </link>
        <updated>2020-03-11T07:39:02.000Z</updated>
        <content type="html"><![CDATA[<h3 id="çˆ¬è™«ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹">çˆ¬è™«ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h3>
<h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨rabbitmq">ä¸ºä»€ä¹ˆä½¿ç”¨rabbitmq</h4>
<p>æˆ‘ä»¬éƒ½çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦ä½œç”¨å°±æ˜¯<code>è§£è€¦ï¼Œå¼‚æ­¥ï¼Œå‰Šå³°</code>ï¼Œåœ¨å¤„ç†çˆ¬è™«çš„æ—¶å€™é‡åˆ°ä¸‹åˆ—è¿™æ ·çš„é—®é¢˜ï¼Œ</p>
<ul>
<li>æœ‰æ—¶å€™çˆ¬å–ç½‘é¡µæ—¶å€™ã€‚æ€»æœ‰æ¼çˆ¬çš„ä¿¡æ¯ã€‚æ¯”å¦‚ä¸€å—åŒºåŸŸå†…å•†å®¶çš„æ¶ˆæ¯è¿™æ ·ï¼Œçˆ¬è™«çªç„¶ä¸­æ–­ï¼Œå¯¼è‡´æ¼çˆ¬ã€‚å¯¹äºæ¼çˆ¬æ˜¯ä¸å¯æ¥å—çš„ï¼Œå› ä¸ºè¿™æ˜¯å®¢æˆ·è¦æ±‚çš„ï¼Œæ‰€ä»¥å°±å¿…é¡»å…ˆä¿å­˜å•†å®¶çš„idå…¥åº“ï¼Œç­‰åˆ°çœŸæ­£é‡‡é›†åˆ°ï¼Œå†åˆ é™¤</li>
<li>å¯¹äºçªç„¶ä¸­æ–­çš„ä»»åŠ¡ï¼Œå¦‚æœé‡‡ç”¨ä¹‹å‰çš„æ–¹å¼ï¼Œæ˜¯æ²¡æœ‰æ¶ˆæ¯é€šçŸ¥çš„ï¼Œ</li>
<li>æˆ‘ä»¬å¯ä»¥å…è®¸æ¶ˆæ¯å¤šæ¬¡æ¶ˆè´¹ï¼Œä½†æ˜¯ä¸èƒ½å…è®¸æ¶ˆæ¯ä¸¢å¤±</li>
<li>å¼‚æ­¥çˆ¬å–ã€‚ä¸å¿…ç«‹å³çˆ¬å–ä¿¡æ¯</li>
</ul>
<p>ç»¼åˆè€ƒå¯Ÿï¼Œå†³å®šé‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšæ¶ˆæ¯å®¹å™¨</p>
<h4 id="å¦‚ä½•ä¿è¯rabbitmqçš„é«˜å¯ç”¨">å¦‚ä½•ä¿è¯rabbitmqçš„é«˜å¯ç”¨</h4>
<p>åœ¨è®¾è®¡çˆ¬è™«ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„æ—¶å€™ï¼Œé«˜å¯ç”¨æ˜¯å¿…é¡»è¦ä¿è¯çš„ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://github.com/Nobodylesszb/ExcellentJava/blob/master/doc/system-design/data-communication/rabbitmq/rabbitmq%E9%AB%98%E5%8F%AF%E7%94%A8.md">rabbitmqé«˜å¯ç”¨</a>)</p>
<p>è¿™æ˜¯æˆ‘å†™çš„ä¸€ç¯‡å…³äºrabbitmqå¦‚ä½•é«˜å¯ç”¨çš„æ–‡ç« </p>
<h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹">å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</h4>
<p>è™½ç„¶åœ¨è®¾è®¡çˆ¬è™«ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„æ—¶å€™å¯¹æ¶ˆæ¯çš„é‡å¤æ€§ä¸æ˜¯é‚£ä¹ˆçš„å…³æ³¨ï¼Œä½†æ˜¯èƒ½ä¸é‡å¤æ¶ˆè´¹æ€»æ˜¯å¥½çš„</p>
<h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“-æ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±é—®é¢˜">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“ã€‚æ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±é—®é¢˜</h4>
<p>æ•°æ®çš„ä¸¢å¤±é—®é¢˜ï¼Œå¯èƒ½å‡ºç°åœ¨ç”Ÿäº§è€…ã€MQã€æ¶ˆè´¹è€…ä¸­ï¼Œå’±ä»¬ä» RabbitMQ å’Œ Kafka åˆ†åˆ«æ¥åˆ†æä¸€ä¸‹å§ã€‚</p>
<h3 id="rabbitmq">RabbitMQ</h3>
<p>[<img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1583676539-rabbitmq-message-lose.png" alt="rabbitmq-message-lose" loading="lazy">]</p>
<h4 id="ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ®">ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ®</h4>
<p>ç”Ÿäº§è€…å°†æ•°æ®å‘é€åˆ° RabbitMQ çš„æ—¶å€™ï¼Œå¯èƒ½æ•°æ®å°±åœ¨åŠè·¯ç»™æä¸¢äº†ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜å•¥çš„ï¼Œéƒ½æœ‰å¯èƒ½ã€‚</p>
<p>æ­¤æ—¶å¯ä»¥é€‰æ‹©ç”¨ RabbitMQ æä¾›çš„äº‹åŠ¡åŠŸèƒ½ï¼Œå°±æ˜¯ç”Ÿäº§è€…<strong>å‘é€æ•°æ®ä¹‹å‰</strong>å¼€å¯ RabbitMQ äº‹åŠ¡<code>channel.txSelect</code>ï¼Œç„¶åå‘é€æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰æˆåŠŸè¢« RabbitMQ æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šæ”¶åˆ°å¼‚å¸¸æŠ¥é”™ï¼Œæ­¤æ—¶å°±å¯ä»¥å›æ»šäº‹åŠ¡<code>channel.txRollback</code>ï¼Œç„¶åé‡è¯•å‘é€æ¶ˆæ¯ï¼›å¦‚æœæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥æäº¤äº‹åŠ¡<code>channel.txCommit</code>ã€‚</p>
<pre><code>// å¼€å¯äº‹åŠ¡
channel.txSelect
try {
    // è¿™é‡Œå‘é€æ¶ˆæ¯
} catch (Exception e) {
    channel.txRollback

    // è¿™é‡Œå†æ¬¡é‡å‘è¿™æ¡æ¶ˆæ¯
}

// æäº¤äº‹åŠ¡
channel.txCommit
</code></pre>
<p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼ŒRabbitMQ äº‹åŠ¡æœºåˆ¶ï¼ˆåŒæ­¥ï¼‰ä¸€æï¼ŒåŸºæœ¬ä¸Š<strong>ååé‡ä¼šä¸‹æ¥ï¼Œå› ä¸ºå¤ªè€—æ€§èƒ½</strong>ã€‚</p>
<p>æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ è¦ç¡®ä¿è¯´å†™ RabbitMQ çš„æ¶ˆæ¯åˆ«ä¸¢ï¼Œå¯ä»¥å¼€å¯ <code>confirm</code> æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§è€…é‚£é‡Œè®¾ç½®å¼€å¯ <code>confirm</code> æ¨¡å¼ä¹‹åï¼Œä½ æ¯æ¬¡å†™çš„æ¶ˆæ¯éƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œç„¶åå¦‚æœå†™å…¥äº† RabbitMQ ä¸­ï¼ŒRabbitMQ ä¼šç»™ä½ å›ä¼ ä¸€ä¸ª <code>ack</code> æ¶ˆæ¯ï¼Œå‘Šè¯‰ä½ è¯´è¿™ä¸ªæ¶ˆæ¯ ok äº†ã€‚å¦‚æœ RabbitMQ æ²¡èƒ½å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œä¼šå›è°ƒä½ çš„ä¸€ä¸ª <code>nack</code> æ¥å£ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶å¤±è´¥ï¼Œä½ å¯ä»¥é‡è¯•ã€‚è€Œä¸”ä½ å¯ä»¥ç»“åˆè¿™ä¸ªæœºåˆ¶è‡ªå·±åœ¨å†…å­˜é‡Œç»´æŠ¤æ¯ä¸ªæ¶ˆæ¯ id çš„çŠ¶æ€ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´è¿˜æ²¡æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯çš„å›è°ƒï¼Œé‚£ä¹ˆä½ å¯ä»¥é‡å‘ã€‚</p>
<p>äº‹åŠ¡æœºåˆ¶å’Œ <code>confirm</code> æœºåˆ¶æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œ<strong>äº‹åŠ¡æœºåˆ¶æ˜¯åŒæ­¥çš„</strong>ï¼Œä½ æäº¤ä¸€ä¸ªäº‹åŠ¡ä¹‹åä¼š<strong>é˜»å¡</strong>åœ¨é‚£å„¿ï¼Œä½†æ˜¯ <code>confirm</code> æœºåˆ¶æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œä½ å‘é€ä¸ªæ¶ˆæ¯ä¹‹åå°±å¯ä»¥å‘é€ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åé‚£ä¸ªæ¶ˆæ¯ RabbitMQ æ¥æ”¶äº†ä¹‹åä¼šå¼‚æ­¥å›è°ƒä½ çš„ä¸€ä¸ªæ¥å£é€šçŸ¥ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶åˆ°äº†ã€‚</p>
<p>æ‰€ä»¥ä¸€èˆ¬åœ¨ç”Ÿäº§è€…è¿™å—<strong>é¿å…æ•°æ®ä¸¢å¤±</strong>ï¼Œéƒ½æ˜¯ç”¨ <code>confirm</code> æœºåˆ¶çš„ã€‚</p>
<h4 id="rabbitmq-å¼„ä¸¢äº†æ•°æ®">RabbitMQ å¼„ä¸¢äº†æ•°æ®</h4>
<p>å°±æ˜¯ RabbitMQ è‡ªå·±å¼„ä¸¢äº†æ•°æ®ï¼Œè¿™ä¸ªä½ å¿…é¡»<strong>å¼€å¯ RabbitMQ çš„æŒä¹…åŒ–</strong>ï¼Œå°±æ˜¯æ¶ˆæ¯å†™å…¥ä¹‹åä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå“ªæ€•æ˜¯ RabbitMQ è‡ªå·±æŒ‚äº†ï¼Œ<strong>æ¢å¤ä¹‹åä¼šè‡ªåŠ¨è¯»å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®</strong>ï¼Œä¸€èˆ¬æ•°æ®ä¸ä¼šä¸¢ã€‚é™¤éæå…¶ç½•è§çš„æ˜¯ï¼ŒRabbitMQ è¿˜æ²¡æŒä¹…åŒ–ï¼Œè‡ªå·±å°±æŒ‚äº†ï¼Œ<strong>å¯èƒ½å¯¼è‡´å°‘é‡æ•°æ®ä¸¢å¤±</strong>ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡è¾ƒå°ã€‚</p>
<p>è®¾ç½®æŒä¹…åŒ–æœ‰<strong>ä¸¤ä¸ªæ­¥éª¤</strong>ï¼š</p>
<ul>
<li>åˆ›å»º queue çš„æ—¶å€™å°†å…¶è®¾ç½®ä¸ºæŒä¹…åŒ–<br>
è¿™æ ·å°±å¯ä»¥ä¿è¯ RabbitMQ æŒä¹…åŒ– queue çš„å…ƒæ•°æ®ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸ä¼šæŒä¹…åŒ– queue é‡Œçš„æ•°æ®çš„ã€‚</li>
<li>ç¬¬äºŒä¸ªæ˜¯å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†æ¶ˆæ¯çš„ <code>deliveryMode</code> è®¾ç½®ä¸º 2<br>
å°±æ˜¯å°†æ¶ˆæ¯è®¾ç½®ä¸ºæŒä¹…åŒ–çš„ï¼Œæ­¤æ—¶ RabbitMQ å°±ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šå»ã€‚</li>
</ul>
<p>å¿…é¡»è¦åŒæ—¶è®¾ç½®è¿™ä¸¤ä¸ªæŒä¹…åŒ–æ‰è¡Œï¼ŒRabbitMQ å“ªæ€•æ˜¯æŒ‚äº†ï¼Œå†æ¬¡é‡å¯ï¼Œä¹Ÿä¼šä»ç£ç›˜ä¸Šé‡å¯æ¢å¤ queueï¼Œæ¢å¤è¿™ä¸ª queue é‡Œçš„æ•°æ®ã€‚</p>
<p>æ³¨æ„ï¼Œå“ªæ€•æ˜¯ä½ ç»™ RabbitMQ å¼€å¯äº†æŒä¹…åŒ–æœºåˆ¶ï¼Œä¹Ÿæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿™ä¸ªæ¶ˆæ¯å†™åˆ°äº† RabbitMQ ä¸­ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œç»“æœä¸å·§ï¼Œæ­¤æ—¶ RabbitMQ æŒ‚äº†ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜é‡Œçš„ä¸€ç‚¹ç‚¹æ•°æ®ä¸¢å¤±ã€‚</p>
<p>æ‰€ä»¥ï¼ŒæŒä¹…åŒ–å¯ä»¥è·Ÿç”Ÿäº§è€…é‚£è¾¹çš„ <code>confirm</code> æœºåˆ¶é…åˆèµ·æ¥ï¼Œåªæœ‰æ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹åï¼Œæ‰ä¼šé€šçŸ¥ç”Ÿäº§è€… <code>ack</code> äº†ï¼Œæ‰€ä»¥å“ªæ€•æ˜¯åœ¨æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰ï¼ŒRabbitMQ æŒ‚äº†ï¼Œæ•°æ®ä¸¢äº†ï¼Œç”Ÿäº§è€…æ”¶ä¸åˆ° <code>ack</code>ï¼Œä½ ä¹Ÿæ˜¯å¯ä»¥è‡ªå·±é‡å‘çš„ã€‚</p>
<h4 id="æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®">æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®</h4>
<p>RabbitMQ å¦‚æœä¸¢å¤±äº†æ•°æ®ï¼Œä¸»è¦æ˜¯å› ä¸ºä½ æ¶ˆè´¹çš„æ—¶å€™ï¼Œ<strong>åˆšæ¶ˆè´¹åˆ°ï¼Œè¿˜æ²¡å¤„ç†ï¼Œç»“æœè¿›ç¨‹æŒ‚äº†</strong>ï¼Œæ¯”å¦‚é‡å¯äº†ï¼Œé‚£ä¹ˆå°±å°´å°¬äº†ï¼ŒRabbitMQ è®¤ä¸ºä½ éƒ½æ¶ˆè´¹äº†ï¼Œè¿™æ•°æ®å°±ä¸¢äº†ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å¾—ç”¨ RabbitMQ æä¾›çš„ <code>ack</code> æœºåˆ¶ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½ å¿…é¡»å…³é—­ RabbitMQ çš„è‡ªåŠ¨ <code>ack</code>ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª api æ¥è°ƒç”¨å°±è¡Œï¼Œç„¶åæ¯æ¬¡ä½ è‡ªå·±ä»£ç é‡Œç¡®ä¿å¤„ç†å®Œçš„æ—¶å€™ï¼Œå†åœ¨ç¨‹åºé‡Œ <code>ack</code> ä¸€æŠŠã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœä½ è¿˜æ²¡å¤„ç†å®Œï¼Œä¸å°±æ²¡æœ‰ <code>ack</code> äº†ï¼Ÿé‚£ RabbitMQ å°±è®¤ä¸ºä½ è¿˜æ²¡å¤„ç†å®Œï¼Œè¿™ä¸ªæ—¶å€™ RabbitMQ ä¼šæŠŠè¿™ä¸ªæ¶ˆè´¹åˆ†é…ç»™åˆ«çš„ consumer å»å¤„ç†ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢çš„ã€‚</p>
<p>[<img src="https://gitee.com/nobodylesszb/upic/raw/pic/upload/pics/1583676540-rabbitmq-message-lose-solution.png" alt="rabbitmq-message-lose-solution" loading="lazy">]</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://Nobodylesszb.github.io/post/hello-gridea/</id>
        <link href="https://Nobodylesszb.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>